{"version":3,"file":"histore.m.js","sources":["../histore.js"],"sourcesContent":["/**\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default function histore() {\n\t// Server\n\tif (typeof history === 'undefined') {\n\t\treturn { get() {}, set() {}, reset() {}, flush() {} }\n\t}\n\n\tlet initialized = true\n\tif (window.__histore_transit === undefined) {\n\t\twindow.__histore_transit = {}\n\t\twindow.__histore_transit_id = -1\n\t\tinitialized = false\n\t}\n\n\tconst get = key => history.state && history.state[key]\n\tconst set = (key, value, immediate = false) => {\n\t\tclearTimeout(window.__histore_transit_id)\n\t\twindow.__histore_transit[key] = value\n\t\t\n\t\tif (immediate) {\n\t\t\tflush()\n\t\t} else {\n\t\t\twindow.__histore_transit_id = setTimeout(() => flush(), 100) // Throttle for chrome\n\t\t} \n\t}\n\n\tconst setTransit = (key, value) => {\n\t\twindow.__histore_transit[key] = value \n\t}\n\n\tconst getTransit = key => window.__histore_transit[key]\n\n\tconst reset = (state) => {\n\t\twindow.__histore_reset = state;\n\t}\n\n\tconst flush = () => {\n\t\thistory.replaceState(window.__histore_transit)\n\t}\n\n\tconst wrapReplace = m => (state, title, url) => {\n\t\treturn m.call(history, Object.assign({}, history.state, state || {}), title, url)\n\t}\n\n\tconst wrapPush = m => (state, title, url) => {\n\t\thistory.replaceState(window.__histore_transit)\n\n\t\tif (window.__histore_reset !== undefined) {\n\t\t\tfor (var prop in window.__histore_reset) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(window.__histore_reset, prop)) {\n\t\t\t\t\twindow.__histore_transit[prop] = window.__histore_reset[prop]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m.call(history, Object.assign({}, history.state, state || {}, window.__histore_transit), title, url)\n\t}\n\n\tif (!initialized) {\n\t\thistory.pushState = wrapPush(history.pushState)\n\t\thistory.replaceState = wrapReplace(history.replaceState)\n\t}\n\n\treturn { set, get, getTransit, setTransit, flush, reset }\n}\n"],"names":["history","get","set","reset","flush","let","initialized","undefined","window","__histore_transit","__histore_transit_id","const","m","replaceState","pushState","state","title","url","__histore_reset","prop","Object","prototype","hasOwnProperty","call","assign","wrapReplace","key","value","immediate","clearTimeout","setTimeout"],"mappings":"eAae,WAEd,GAAuB,oBAAZA,QACV,OAASC,iBAAUC,iBAAUC,mBAAYC,oBAG1CC,IAAIC,GAAc,OACeC,IAA7BC,OAAOC,oBACVD,OAAOC,qBACPD,OAAOE,sBAAwB,EAC/BJ,GAAc,GAGfK,IA8BiBC,EARXR,aACLJ,QAAQa,aAAaL,OAAOC,oBA0B7B,OALKH,IACJN,QAAQc,WAfQF,EAeaZ,QAAQc,mBAffC,EAAOC,EAAOC,GAGpC,GAFAjB,QAAQa,aAAaL,OAAOC,wBAEGF,IAA3BC,OAAOU,gBACV,IAAK,IAAIC,KAAQX,OAAOU,gBACnBE,OAAOC,UAAUC,eAAeC,KAAKf,OAAOU,gBAAiBC,KAChEX,OAAOC,kBAAkBU,GAAQX,OAAOU,gBAAgBC,IAK3D,OAAOP,EAAEW,KAAKvB,QAASoB,OAAOI,UAAWxB,QAAQe,MAAOA,MAAaP,OAAOC,mBAAoBO,EAAOC,KAKvGjB,QAAQa,sBApBWD,mBAAMG,EAAOC,EAAOC,UAChCL,EAAEW,KAAKvB,QAASoB,OAAOI,UAAWxB,QAAQe,MAAOA,OAAcC,EAAOC,IAmBtDQ,CAAYzB,QAAQa,6BA7C/Ba,EAAKC,EAAOC,mBAAY,GACpCC,aAAarB,OAAOE,sBACpBF,OAAOC,kBAAkBiB,GAAOC,EAE5BC,EACHxB,IAEAI,OAAOE,qBAAuBoB,6BAAiB1B,KAAS,mBAR9CsB,UAAO1B,QAAQe,OAASf,QAAQe,MAAMW,wBAgB/BA,UAAOlB,OAAOC,kBAAkBiB,wBAJ/BA,EAAKC,GACxBnB,OAAOC,kBAAkBiB,GAAOC,SAoCUvB,iBA/B5BW,GACdP,OAAOU,gBAAkBH"}