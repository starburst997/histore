{"version":3,"file":"histore.m.js","sources":["../histore.js"],"sourcesContent":["/**\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default function histore() {\n\t// Server\n\tif (typeof history === 'undefined') {\n\t\treturn { get() {}, set() {}, reset() {}, flush() {} };\n\t}\n\n\tlet initialized = true\n\tif (window.__histore_transit === undefined) {\n\t\twindow.__histore_transit = {}\n\t\twindow.__histore_transit_id = -1\n\t\tinitialized = false\n\t}\n\n\tconst get = key => history.state && history.state[key]\n\tconst set = (key, value) => {\n\t\tclearTimeout(window.__histore_transit_id)\n\t\twindow.__histore_transit[key] = value;\n\t\twindow.__histore_transit_id = setTimeout(() => flush(), 100) // Throttle for chrome\n\t}\n\n\tconst getTransit = key => window.__histore_transit[key]\n\n\tconst reset = (state) => {\n\t\twindow.__histore_reset = state;\n\t}\n\n\tconst flush = () => {\n\t\tconsole.log(`FLUSH`)\n\t\tconsole.log(window.__histore_transit)\n\t\thistory.replaceState(window.__histore_transit);\n\t}\n\n\tconst wrapReplace = m => (state, title, url) => {\n\t\treturn m.call(history, Object.assign({}, history.state, state || {}), title, url)\n\t}\n\n\tconst wrapPush = m => (state, title, url) => {\n\t\thistory.replaceState(window.__histore_transit)\n\n\t\tif (window.__histore_reset !== undefined) {\n\t\t\tfor (var prop in window.__histore_reset) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(window.__histore_reset, prop)) {\n\t\t\t\t\twindow.__histore_transit[prop] = window.__histore_reset[prop]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn m.call(history, Object.assign({}, history.state, state || {}, window.__histore_transit), title, url)\n\t}\n\n\tif (!initialized) {\n\t\thistory.pushState = wrapPush(history.pushState);\n\t\thistory.replaceState = wrapReplace(history.replaceState);\n\t}\n\n\treturn { set, get, getTransit, flush, reset };\n}\n"],"names":["history","get","set","reset","flush","let","initialized","undefined","window","__histore_transit","__histore_transit_id","const","m","console","log","replaceState","pushState","state","title","url","__histore_reset","prop","Object","prototype","hasOwnProperty","call","assign","wrapReplace","key","value","clearTimeout","setTimeout"],"mappings":"eAae,WAEd,GAAuB,oBAAZA,QACV,OAASC,iBAAUC,iBAAUC,mBAAYC,oBAG1CC,IAAIC,GAAc,OACeC,IAA7BC,OAAOC,oBACVD,OAAOC,qBACPD,OAAOE,sBAAwB,EAC/BJ,GAAc,GAGfK,IAuBiBC,EAVXR,aACLS,QAAQC,IAAI,SACZD,QAAQC,IAAIN,OAAOC,mBACnBT,QAAQe,aAAaP,OAAOC,oBA0B7B,OALKH,IACJN,QAAQgB,WAfQJ,EAeaZ,QAAQgB,mBAffC,EAAOC,EAAOC,GAGpC,GAFAnB,QAAQe,aAAaP,OAAOC,wBAEGF,IAA3BC,OAAOY,gBACV,IAAK,IAAIC,KAAQb,OAAOY,gBACnBE,OAAOC,UAAUC,eAAeC,KAAKjB,OAAOY,gBAAiBC,KAChEb,OAAOC,kBAAkBY,GAAQb,OAAOY,gBAAgBC,IAK3D,OAAOT,EAAEa,KAAKzB,QAASsB,OAAOI,UAAW1B,QAAQiB,MAAOA,MAAaT,OAAOC,mBAAoBS,EAAOC,KAKvGnB,QAAQe,sBApBWH,mBAAMK,EAAOC,EAAOC,UAChCP,EAAEa,KAAKzB,QAASsB,OAAOI,UAAW1B,QAAQiB,MAAOA,OAAcC,EAAOC,IAmBtDQ,CAAY3B,QAAQe,6BAtC/Ba,EAAKC,GACjBC,aAAatB,OAAOE,sBACpBF,OAAOC,kBAAkBmB,GAAOC,EAChCrB,OAAOE,qBAAuBqB,6BAAiB3B,KAAS,mBAJ7CwB,UAAO5B,QAAQiB,OAASjB,QAAQiB,MAAMW,wBAO/BA,UAAOpB,OAAOC,kBAAkBmB,UAmCpBxB,iBAjChBa,GACdT,OAAOY,gBAAkBH"}